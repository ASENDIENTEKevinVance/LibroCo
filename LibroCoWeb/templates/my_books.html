<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/stylereaderdash.css') }}">
	<link rel="stylesheet" href="{{ url_for('static', filename='css/mybooksstyle.css') }}">
    <link rel="icon" type="logo/icon" href="../static/images/favicon.ico">
    <title> My Books | LibroCo. </title>
</head>

<body>
    <nav>
        <a class="navbar-brand" href="{{ url_for('library') }}"><img div class="logo" src="../static/images/logo.png" width="250" height="50" />
        </a>

        <div class="separator"></div>

        <div class="navbar-links">
            <a href="{{ url_for('library') }}"> Library </a>
            <a href="{{ url_for('my_books') }}" class="active"> My Books </a>
            <a href="{{ url_for('wishlist') }}"> Wishlist </a>
        </div>

        <div class="navbar-right">
            <a href="{{ url_for('reader_profile') }}"> Profile </a>
            <a href="{{ url_for('logout') }}"> Log Out </a>
        </div>
    </nav>

    <div class="main-content">
        <div class="header-row">
            <div class="search-container">
                <input type="text" placeholder="Search a book, author, or etc." class="search-input">
                <button class="search-btn"><img src="../static/images/magnify.png"></button><!-- Search icon -->
            </div>
        </div> 
    
    <div class="divider"></div> <!-- Line divider -->

    <!-- Container for "My Books" list -->
    <div class="container">
        <div class="book-list">
            {% for book in books %}
                <div class="book-item" id="book{{ book['book_id'] }}" data-due-date="{{ book['due_date'] }}">
                    <img src="{{ url_for('static', filename='images/' + book['image']) }}" alt="{{ book['book_title'] }} Cover" class="book-cover">
                    <div class="book-details">
                        <h2 class="book-title">{{ book['book_title'] }}</h2>
                        <p>{{ book['author'] }}</p>

                        <!-- Status Section -->
                        <p class="status 
                            {% if book['due_date'] < today %}
                                overdue
                            {% elif book['due_date'] <= today + timedelta(days=3) %}
                                expiring
                            {% else %}
                                available
                            {% endif %}
                        ">
                            {% if book['due_date'] < today %}
                                Overdue
                            {% elif book['due_date'] <= today + timedelta(days=3) %}
                                Expiring
                            {% else %}
                                Available
                            {% endif %}
                        </p>
                    </div>
                    <form action="{{ url_for('return_book', book_id=book['book_id']) }}" method="post">
                        <button class="return" type="submit">Return</button>
                    </form>
                </div>
            {% endfor %}
        </div>
    </div>
    
	
	<script>
   function returnBook(bookId) {
            const bookElement = document.getElementById(bookId);
            if (bookElement) {
                const bookTitle = bookElement.querySelector(".book-title").textContent;
                alert(`You have returned ${bookTitle}`);

                // Remove the book element from the DOM
                bookElement.remove();
            } else {
                console.log("Book element not found for id: " + bookId);
            }
        }

        function renewBook(bookId) {
            const bookElement = document.getElementById(bookId);
            const dueDate = new Date(bookElement.dataset.dueDate);
            const today = new Date();

            if (dueDate > today) {
                alert(`The book '${bookElement.querySelector(".book-title").textContent}' has been renewed.`);
            } else {
                alert("Cannot renew. Book is overdue.");
            }
        }
</script>

</body>

</html>